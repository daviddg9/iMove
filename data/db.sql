CREATE DATABASE IMOVE;
USE IMOVE;

CREATE TABLE ROUTES(
	ROUTE_ID		    VARCHAR(10),
    ROUTE_SHORT_NAME	VARCHAR(4),
    ROUTE_LONG_NAME 	VARCHAR(125),
    ROUTE_COLOR			VARCHAR(7),
    
    PRIMARY KEY (ROUTE_ID)
);

CREATE TABLE STOPS(
	STOP_ID		VARCHAR(5),
    STOP_NAME	VARCHAR(50),
    STOP_LAT	VARCHAR(25),
    STOP_LON	VARCHAR(25),
    
    PRIMARY KEY (STOP_ID)
);

CREATE TABLE ROUTE_STOPS(
    STOP_ID		VARCHAR(5),
    ROUTE_ID	VARCHAR(10),

    CONSTRAINT FK_ROUTE_STOPS_STOP_ID FOREIGN KEY (STOP_ID) REFERENCES STOPS(STOP_ID),
    CONSTRAINT FK_ROUTE_STOPS_ROUTE_ID FOREIGN KEY (ROUTE_ID) REFERENCES ROUTES(ROUTE_ID)
);

CREATE TABLE TRIPS(
	TRIP_ID			VARCHAR(15),
    ROUTE_ID		VARCHAR(10),
    SERVICE_ID		VARCHAR(5),
    
    PRIMARY KEY (TRIP_ID),
    CONSTRAINT FK_TRIPS_ROUTE_ID FOREIGN KEY (ROUTE_ID) REFERENCES ROUTES(ROUTE_ID)
);

CREATE TABLE STOP_TIMES(
	TRIP_ID 		VARCHAR(15),
    STOP_ID 		VARCHAR(5),
    ARRIVAL_TIME 	TIME,
    DEPARTURE_TIME 	TIME,
    STOP_SEQUENCE	INT,
    
    CONSTRAINT FK_STOP_TIMES_TRIP_ID FOREIGN KEY (TRIP_ID) REFERENCES TRIPS(TRIP_ID),
    CONSTRAINT FK_STOP_TIMES_STOP_ID FOREIGN KEY (STOP_ID) REFERENCES STOPS(STOP_ID)
);

/*
SELECT STOPS.STOP_ID, STOPS.STOP_NAME, ROUTES.ROUTE_ID, ROUTES.ROUTE_SHORT_NAME, ROUTES. ROUTE_LONG_NAME FROM ROUTES
INNER JOIN TRIPS ON ROUTES.ROUTE_ID = TRIPS.ROUTE_ID
INNER JOIN STOP_TIMES ON TRIPS.TRIP_ID = STOP_TIMES.TRIP_ID
INNER JOIN STOPS ON STOP_TIMES.STOP_ID = STOPS.STOP_ID
WHERE STOPS.STOP_ID = '18000'
GROUP BY ROUTES.ROUTE_ID
SORT BY ROUTES.ROUTE_ID;
*/

/* BORRAR PARADAS NO MADRILEÃ‘AS
DELETE FROM STOPS 
WHERE STOP_ID NOT IN (
    SELECT STOP_TIMES.STOP_ID FROM STOP_TIMES 
    INNER JOIN TRIPS ON STOP_TIMES.TRIP_ID = TRIPS.TRIP_ID 
    INNER JOIN ROUTES ON TRIPS.ROUTE_ID = ROUTES.ROUTE_ID    
);

*/